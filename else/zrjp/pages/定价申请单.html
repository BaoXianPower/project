<!DOCTYPE html>
<html lang="en">
<head>
  <title>定价申请单</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <meta name="author" content="http://jeesite.com/"/>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10"/>
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Cache-Control" content="no-cache">
  <script src="http://lmk.javang.cn/zrjp/static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
  <link href="http://lmk.javang.cn/zrjp/static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css"
        rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
  <link href="http://lmk.javang.cn/zrjp/static/bootstrap/2.3.1/awesome/span-awesome.min.css" type="text/css"
        rel="stylesheet"/>
  <!--[if lte IE 7]>
  <link href="http://lmk.javang.cn/zrjp/static/bootstrap/2.3.1/awesome/span-awesome-ie7.min.css" type="text/css"
        rel="stylesheet"/><![endif]-->
  <!--[if lte IE 6]>
  <link href="http://lmk.javang.cn/zrjp/static/bootstrap/bsie/css/bootstrap-ie6.min.css" type="text/css"
        rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/bootstrap/bsie/js/bootstrap-ie.min.js"
          type="text/javascript"></script><![endif]-->
  <link href="http://lmk.javang.cn/zrjp/static/jquery-select2/3.4/select2.min.css" rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/jquery-select2/3.4/select2.min.js" type="text/javascript"></script>
  <link href="http://lmk.javang.cn/zrjp/static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css"
        rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/jquery-validation/1.11.0/jquery.validate.min.js"
          type="text/javascript"></script>
  <link href="http://lmk.javang.cn/zrjp/static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/jquery-jbox/2.3/jquery.jBox-2.3.min.js"
          type="text/javascript"></script>

  <script src="http://lmk.javang.cn/zrjp/static/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
  <script src="http://lmk.javang.cn/zrjp/static/common/mustache.min.js" type="text/javascript"></script>
  <link href="http://lmk.javang.cn/zrjp/static/common/jeesite.css" type="text/css" rel="stylesheet"/>
  <script src="http://lmk.javang.cn/zrjp/static/common/jeesite.js" type="text/javascript"></script>
  <script type="text/javascript">var ctx = '/zrjp/a', ctxStatic = 'http://lmk.javang.cn/zrjp/static'</script>
  <!-- Baidu tongji analytics -->
  <script>var _hmt = _hmt || [];
  (function () {
    var hm = document.createElement('script')
    hm.src = '//hm.baidu.com/hm.js?82116c626a8d504a5c0675073362ef6f'
    var s = document.getElementsByTagName('script')[0]
    s.parentNode.insertBefore(hm, s)
  })()</script>


  <meta name="decorator" content="default"/>
  <link rel="stylesheet" href="./css/zrjp.css">

  <script src="layer/layer.js"></script>
</head>
<body>
<button class="btn" type="button" onclick="showModal()">点击显示弹出层</button>


<!--弹出层中的内容用  class="zrjp-layer-modal"  包裹-->
<div class="zrjp-layer-modal">
  <div class="request-order">
    <p class="order-num">院内编号：（<span>1600-03279</span>）</p>
    <div class="order-info clearfix">
      <p class="title">检验要求或说明</p>
      <div class="item">
        <label class="name">型号：</label>
        <div
            class="content"> Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus culpa earum error,</div>
      </div>
      <div class="item">
        <label class="name">报告编号：</label>
        <div
            class="content">Lorem ipsum dolor sit amet, </div>
      </div>
      <div class="item">
        <label class="name">检测依据：</label>
        <div class="content">
          Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusamus culpa earum error,
        </div>
      </div>

      <div class="item">
        <label class="name">申请人：</label>
        <div class="content">张三</div>
      </div>
      <div class="item">
        <label class="name">部门：</label>
        <div class="content">技术部</div>
      </div>
      <div class="item">
        <label class="name">日期：</label>
        <div class="content">
          2018-04-05
        </div>
      </div>
    </div>
    <div class="order-list">
      <table class="table table-striped table-bordered table-condensed">
        <thead>
        <tr>
          <th>序号</th>
          <th>检测标准/项目</th>
          <th>全项目</th>
          <th>部分项目</th>
          <th>费用</th>
          <th>备注</th>
          <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td>1</td>
          <td>
            <input type="text" name="bz" placeholder="请选择检测标准" class="js-hook-bz">
          </td>
          <td>
            <select class="js-hook-select">
              <option value="">选择检测项</option>
              <option value="1">全部</option>
              <option value="2">部分</option>
            </select>
          </td>
          <td>
            <input type="text" placeholder="请选择检测项目" readonly class="js-hook-bfxm">
          </td>
          <td>
            <input type="text" placeholder="检测费用" readonly>
          </td>
          <td>
            <textarea name="" id="" cols="30" rows="2" placeholder="备注"></textarea>
          </td>
          <td>
            <button type="button" class="btn btn-info btn-small js-hook-addOrderItem">增加</button>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!--选择标准弹出层-->
<div class="zrjp-layer-num-list" style="display: none;">
  <table class="table table-striped table-bordered table-condensed">
    <thead>
    <tr>
      <th></th>
      <th>序号</th>
      <th>检测标准</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180405"></td>
      <td>1</td>
      <td>gb20180405</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180406"></td>
      <td>1</td>
      <td>gb20180406</td>
    </tr>
    <tr>
      <td><input type="radio" name="numList" value="gb20180407"></td>
      <td>1</td>
      <td>gb20180407</td>
    </tr>
    </tbody>
  </table>
  <div class="btns text-center">
    <button class="btn btn-primary btn-ok">确认</button>
    <button class="btn btn-danger btn-cancel">取消</button>
  </div>
</div>

<!--二级分类弹出层-->
<div class="zrjp-layer-select-all" style="display: none">
  <table class="table table-striped table-bordered table-condensed">
    <thead>
    <tr>
      <th>章节</th>
      <th></th>
      <th>次数</th>
      <th>检测项目名称</th>
      <th>单位</th>
      <th>收费标准</th>
      <th>折扣</th>
      <th>金额</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>1</td>
      <td><input type="checkbox" name="level2" id="lv1"></td>
      <td><input type="text" value="1" readonly></td>
      <td>1次</td>
      <td>项目1</td>
      <td>20.00</td>
      <td>18.00</td>
      <td>18.00</td>
    </tr>
    <tr>
      <td>2</td>
      <td><input type="checkbox" name="level2" id="lv2"></td>
      <td><input type="text" value="1" readonly></td>
      <td>1次</td>
      <td>项目2</td>
      <td>30.00</td>
      <td>10.00</td>
      <td>10.00</td>
    </tr>
    <tr>
      <td>3</td>
      <td><input type="checkbox" name="level2" id="lv3"></td>
      <td><input type="text" value="1" readonly></td>
      <td>1次</td>
      <td>项目3</td>
      <td>20.00</td>
      <td>15.00</td>
      <td>5.00</td>
    </tr>
    </tbody>
  </table>
  <div class="btns text-center">
    <button class="btn btn-primary btn-ok">确认</button>
    <button class="btn btn-danger btn-cancel">取消</button>
  </div>
</div>

<script>
  var parentModal,      //全屏弹出层
    numListModal,     //标准号对应弹出层，关闭时会用到
    allProjectModal,    //分类弹出层
    activeRow,        //全屏弹出层点击的行数
    allProjectVal = []       //全部项目选择的值
  /*显示弹出层*/
  function showModal () {
    parentModal = layer.open({
      type: 1,
      title: '定价申请单',
      skin: 'layui-layer-rim', //加上边框
      area: ['100%', '100%'], //宽高
      content: $('.zrjp-layer-modal'),  //弹出层中的内容
      cancel: function () {    //解决 select2初始化的下拉框展开的状态下，点右上角的关闭按钮，下拉框无法关闭
        $('.select2-drop').hide()
      }
    })
  }

  //添加一列
  $(document).on('click', '.js-hook-addOrderItem', function () {
    var isSomeProject = $(this).parents('tr').find('.js-hook-bfxm').val()
    if(!isSomeProject){
      layer.msg('请选择需要检测的项目！')
    }else {
      var delBtn = '<input type="button" class="btn btn-danger btn-small del-form-row" value="删除" style="vertical-align: top">'
      var clone = $(this).parents('tbody').find('tr:eq(0)').clone()
      clone.find('input').val('')
      clone.find('textarea').val('')
      var select = clone.find('td:eq(2) select').prop('outerHTML')
      clone.find('td:eq(2)').html(select)
      clone.find('td:eq(2) select').select2()
      clone.find('td:last-child').append(delBtn)
      $('.order-list tbody').append(clone)
    }
  })

  //删除一列
  $(document).on('click', '.del-form-row', function () {
    $(this).parents('tr').remove()
  })

  //检测标准输入框获取焦点时的弹出层
  $(document).on('focus', '.js-hook-bz', function () {
    activeRow = $(this).parents('tr').index()
    numListModal = layer.open({
      type: 1,
      title: '检测标准',
      skin: 'layui-layer-rim', //加上边框
      area: ['60%', '75%'], //宽高
      content: $('.zrjp-layer-num-list'),  //弹出层中的内容
      cancel: function () {    //解决 select2初始化的下拉框展开的状态下，点右上角的关闭按钮，下拉框无法关闭
      }
    })
  })

  //检测标准弹出层
  $('.zrjp-layer-num-list .btn-ok').click(function () {
    var bzNum = $('.zrjp-layer-num-list input[name=numList]:checked').val()
    if (bzNum) {
      $('.js-hook-bz:eq(' + activeRow + ')').val(bzNum)
      $('.zrjp-layer-num-list input[name=numList]').attr('checked', false)
      layer.close(numListModal)
    } else {
      layer.msg('请选择检测标准！')
    }
  })

  //关闭检测标准弹出层
  $('.zrjp-layer-num-list .btn-cancel').click(function () {
    $('.zrjp-layer-num-list input[name=numList]').attr('checked', false)
    layer.close(numListModal)
  })

  //下拉框的值为2的时候显示弹出层
  $(document).on('select2-close', '.js-hook-select', function (e) {
    activeRow = $(this).parents('tr').index()
    if ($(this).val() == 2) {
      $(this).parents('tr').find('.js-hook-bfxm').attr('disabled', false)
      allProjectModal = layer.open({
        type: 1,
        title: '选择检测项目',
        skin: 'layui-layer-rim', //加上边框
        area: ['60%', '75%'], //宽高
        content: $('.zrjp-layer-select-all'),  //弹出层中的内容
        cancel: function () {    //解决 select2初始化的下拉框展开的状态下，点右上角的关闭按钮，下拉框无法关闭
        }
      })
    } else if ($(this).val() == 1) {
      allProjectVal = [];
      $.each($('.zrjp-layer-select-all input[name=level2]'), function () {
        $(this).attr('checked',true)
        $(this).parents('tr').find('input[type=text]').attr('readonly',false)
//        allProjectVal.push({id: $(this).attr('id'), number: $(this).parents('tr').find('input[type=text]').val()})
      })
      allProjectModal = layer.open({
        type: 1,
        title: '选择检测项目',
        skin: 'layui-layer-rim', //加上边框
        area: ['60%', '75%'], //宽高
        content: $('.zrjp-layer-select-all'),  //弹出层中的内容
        cancel: function () {    //解决 select2初始化的下拉框展开的状态下，点右上角的关闭按钮，下拉框无法关闭
        }
      })
      $('.js-hook-bfxm:eq('+activeRow+')').val(allProjectVal)
      console.log('选中的值为：', allProjectVal)
      $(this).parents('tr').find('.js-hook-bfxm').attr('disabled', false)
    } else if($(this).val() ==''){
      allProjectVal = []
      console.log('选中的值为：', allProjectVal)
      $(this).parents('tr').find('.js-hook-bfxm').attr('disabled', true).val('')
    }
  })

  //判断checkbox是否选中
  $('.zrjp-layer-select-all input[type=checkbox]').click(function () {
    if($(this).prop('checked')===true){
      $(this).parents('tr').find('input[type=text]').attr('readonly',false)
    }else {
      $(this).parents('tr').find('input[type=text]').attr('readonly',true).val('1')
    }
  })

  //获取选中的id和次数
  $('.zrjp-layer-select-all .btn-ok').click(function () {
    var valArr = []
    $.each($('.zrjp-layer-select-all input[name=level2]:checked'), function () {
      valArr.push({id: $(this).attr('id'), number: $(this).parents('tr').find('input[type=text]').val()})
    })
    if (valArr.length > 0) {
      allProjectVal = valArr
      $('.js-hook-bfxm:eq('+activeRow+')').val(allProjectVal)
      console.log('选中的值为：', allProjectVal)
      $('.zrjp-layer-select-all input[name=level2]').attr('checked', false)
      layer.close(allProjectModal)
    } else {
      layer.msg('请选择需要检测的项目！')
    }
  })

  //取消检测项目选择
  $('.zrjp-layer-select-all .btn-cancel').click(function () {
    $('.zrjp-layer-select-all input[name=level2]').attr('checked', false)
    $('.zrjp-layer-select-all input[type=text]').attr('readonly', true)
    layer.close(allProjectModal)
  })

</script>
</body>
</html>